<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReWrap | Phone Selection</title>
    <link rel="stylesheet" href="variables.css">
    <link rel="stylesheet" href="nav_styles.css">
    <link rel="stylesheet" href="custom_wraps_styles.css">
    <link rel="stylesheet" href="main_styles.css">
    <link rel="stylesheet" href="footer_styles.css">
    <link rel="shortcut icon" href="assets/site_icon.ico">
</head>
<body>
    <!-- Nav bar -->
    <div id="navContainer">
        <img id="navLogo" src="ui_images/nav_logo.svg" alt="ReWrap Logo" onmousedown="redirect('index.html', event)">
        <ul>
            <li id="whatnewLI"><a href="new.html">What's New</a></li>
            <li id="customLI"><a href="phone_selection.html?type=custom">Custom</a></li>
            <li id="presetsLI"><a href="phone_selection.html?type=presets">Presets</a></li>
            <li id="stickersLI"><a href="stickers.html">Stickers</a></li>
        </ul>
        <div id="helpIcon" onmousedown="redirect('help.html', event)"><p>?</p></div>
    </div>

    <!-- Sub-Nav -->
    <div id="subNav">
        <span id="subNavHeading">>>&#160</span>
        <span id="returnToSelection" onmousedown="redirect('phone_selection.html?type=custom', event)">Phone selection</span>
        <span>&#160>>&#160</span>
        <span>Upload and position image</span>
    </div>

    <!-- Hidden phone for computing styles -->
    <img id="hiddenImage" alt="hidden image">

    <!-- Custom wrap interface -->
    <div id="customWrapContainer">
        <div id="phoneBackContainer">
            <h1 id="selectedPhoneName"></h1>
            <div id="customImageDiv">
                <img id="selectedPhoneMask">
            </div>
            <p>[Wrap Preview]</p>
        </div>
        <div id="selectorUIContainer">
            <!-- Child 1: Step one instructions + Dark slider + Clear -->
            <div>
                <span class="number">1.</span>
                <span class="heading">Upload or link your image</span>
                <img id="deleteButton" onclick="resetImage()" src="ui_images/bin_icon.svg" alt="Clear Button" title="Reset Image">
                <input id="brightnessSlider" type="range" min="0" max="10" value="5">
            </div>
            <!-- Child 2: Upload image box -->
            <div>
                <img id="uploadButton" src="ui_images/cloud_icon.svg" title="Upload Image">
                <input type="text" placeholder="Click icon to upload file [currently unavailable]" readonly>
            </div>
            <!-- Child 3: Link image box -->
            <div>
                <img id="linkButton" onclick="pasteLink()" src="ui_images/link_icon.svg" title="Paste Link">
                <input id="linkBox" type="text" placeholder="Click icon to paste link"
                    onpaste="updateImage(this)" onchange="updateImage(this)" oninput="updateImage(this)">
            </div>
            <!-- Child 4: Step 2 instructions -->
            <div>
                <span class="number">2.</span>
                <span class="heading">Scale and position image</span>
            </div>
            <!-- Child 5: Adjustment UI container -->
            <div id="controlsUIContainer">
                <div>
                    <span class="adjustmentTitle">Scale:</span>
                    <img id="scaleReset" src="ui_images/reset_button.svg" alt="Reset Slider" title="Reset Slider">
                    <span id="scalePlus">>></span>
                    <input id="scaleValue" class="adjustmentValue" type="text", value="100">
                    <span id="scaleMinus"><<</span>
                    <div>
                        <input id="scaleSlider" class="adjustmentSlider" type="range" min="1" max="300" value="100">
                    </div>
                </div>
                <div>
                    <span class="adjustmentTitle">X Position:</span>
                    <img id="xposReset" src="ui_images/reset_button.svg" alt="Reset Slider" title="Reset Slider">
                    <span id="xposPlus">>></span>
                    <input id="xposValue" class="adjustmentValue" type="text", value="0">
                    <span id="xposMinus"><<</span>
                    <div>
                        <input id="xposSlider" class="adjustmentSlider" type="range" min="-500" max="500" value="0">
                    </div>
                </div>
                <div>
                    <span class="adjustmentTitle">Y Position:</span>
                    <img id="yposReset" src="ui_images/reset_button.svg" alt="Reset Slider" title="Reset Slider">
                    <span id="yposPlus">>></span>
                    <input id="yposValue" class="adjustmentValue" type="text", value="0">
                    <span id="yposMinus"><<</span>
                    <div>
                        <input id="yposSlider" class="adjustmentSlider" type="range" min="-200" max="200" value="0">
                    </div>
                </div>
                <div>
                    <span class="adjustmentTitle">Rotation:</span>
                    <img id="rotationReset" src="ui_images/reset_button.svg" alt="Reset Slider" title="Reset Slider">
                    <span id="rotationPlus">>></span>
                    <input id="rotationValue" class="adjustmentValue" type="text", value="0">
                    <span id="rotationMinus"><<</span>
                    <div>
                        <input id="rotationSlider" class="adjustmentSlider" type="range" min="0" max="360" value="0">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Sub-Footer -->
    <div id="subFooter">
        <span onclick="backToTop()">Back to top â–²</span>
    </div>

    <!-- Footer -->
    <div id="footerContainer">
        <div id="footerSocials">
            <h1>Our Socials: </h1>
            <div>
                <a href="https://www.instagram.com/rewrap_nz/" target="_blank" rel="noreferrer noopener" title="@rewrap_nz">
                    <img src="ui_images/instagram_logo.svg" alt="Intagram Logo">
                </a>
                <a onclick="emailPrompt()" title="rewrapvinyl@gmail.com">
                    <img src="ui_images/mail_icon.svg" alt="Mail Icon">
                </a>
            </div>
            <input type="text" value="rewrapvinyl@gmail.com" id="hiddenEmail" readonly>
        </div>
    </div>

    <!--#########-->
    <!-- Scripts -->
    <!--#########-->

    <script src="global_functions.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.4.2/firebase-analytics.js"></script>

    <script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
        apiKey: "AIzaSyCVFVGnuER8SzjpRnYFba_dOzzQRG_kwnw",
        authDomain: "rewrap-website.firebaseapp.com",
        projectId: "rewrap-website",
        storageBucket: "rewrap-website.appspot.com",
        messagingSenderId: "615977953801",
        appId: "1:615977953801:web:02d4ac995c7a4b1cc426d8",
        measurementId: "G-PFB53Q7DJW"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    </script>

    <!-- Update image -->
    <script>
        var phoneMask = document.getElementById("selectedPhoneMask");
        var hiddenImage = document.getElementById("hiddenImage");
        function updateImage(element) {
            // Update image source
            if(element.id == "linkBox") {
                var value = document.getElementById("linkBox").value;
                var url = "url("+value+")";
                root.style.setProperty("--source", url);
                hiddenImage.setAttribute("src", linkBox.value);
            }
            // Resize hidden image
            var containerSize = phoneMask.getBoundingClientRect();
            hiddenImage.style.height = containerSize.height+"px";
            // Set psudo element width to hidden image width
            var imageSize = hiddenImage.getBoundingClientRect();
            root.style.setProperty("--imageWidth", imageSize.width+"px");

        }
    </script>


    <!-- Reset image -->
    <script>
        function resetImage() {
            // Reload page
            location.reload();
        }
    </script>


    <!-- Paste link -->
    <script>
        function pasteLink() {
            var linkBox = document.getElementById("linkBox");
            linkBox.select();
            linkBox.setAttribute("value", "");
            navigator.clipboard.readText()
            .then(text => {
                linkBox.value = text;
                updateImage(linkBox);
            })
            .catch(err => {
                console.error('Failed to read clipboard contents: ', err);
            });
        }
    </script>

    <!-- Adjust uploaded image  -->
    <script>
        const root = document.querySelector(":root");
        var variableCategory;
        var unitValue;
        function updateAdjustment(category, value) {
            if(category == "rotation") {
                unitValue = value+"deg";
            } else if(category == "scale") {
                unitValue = value/100;
            } else {
                unitValue = value+"%";
            }
            variableCategory = "--"+category;
            root.style.setProperty(variableCategory, unitValue);
        }
        // Scaling settings
        var scaleSlider = document.getElementById("scaleSlider");
        var scaleValue = document.getElementById("scaleValue");
        var scalePlus = document.getElementById("scalePlus");
        var scaleMinus = document.getElementById("scaleMinus");
        var scaleReset = document.getElementById("scaleReset");
        scaleSlider.oninput = function() {
            scaleValue.value = this.value;
            updateAdjustment("scale", this.value);
        }
        scaleValue.oninput = function() {
            scaleSlider.value = this.value;
            updateAdjustment("scale", this.value);
        }
        scalePlus.onclick = function() {
            scaleValue.value ++;
            scaleSlider.value = scaleValue.value;
            updateAdjustment("scale", scaleValue.value);
        }
        scaleMinus.onclick = function() {
            if(scaleValue.value > scaleSlider.min) {
                scaleValue.value --;
                scaleSlider.value = scaleValue.value;
                updateAdjustment("scale", scaleValue.value);
            }
        }
        scaleReset.onclick = function() {
            scaleValue.value = scaleValue.getAttribute("value");
            scaleSlider.value = scaleValue.value;
            updateAdjustment("scale", scaleValue.value);
        }
        // X position settings
        var xposSlider = document.getElementById("xposSlider");
        var xposValue = document.getElementById("xposValue");
        var xposPlus = document.getElementById("xposPlus");
        var xposMinus = document.getElementById("xposMinus");
        var xposReset = document.getElementById("xposReset");
        xposSlider.oninput = function() {
            xposValue.value = this.value;
            updateAdjustment("xpos", this.value);
        }
        xposValue.oninput = function() {
            xposSlider.value = this.value;
            updateAdjustment("xpos", this.value);
        }
        xposPlus.onclick = function() {
            xposValue.value ++;
            xposSlider.value = xposValue.value;
            updateAdjustment("xpos", xposValue.value);
        }
        xposMinus.onclick = function() {
            xposValue.value --;
            xposSlider.value = xposValue.value;
            updateAdjustment("xpos", xposValue.value);
        }
        xposReset.onclick = function() {
            xposValue.value = xposValue.getAttribute("value");
            xposSlider.value = xposValue.value;
            updateAdjustment("xpos", xposValue.value);
        }
        // Y position settings
        var yposSlider = document.getElementById("yposSlider");
        var yposValue = document.getElementById("yposValue");
        var yposPlus = document.getElementById("yposPlus");
        var yposMinus = document.getElementById("yposMinus");
        var yposReset = document.getElementById("yposReset");
        yposSlider.oninput = function() {
            yposValue.value = this.value;
            updateAdjustment("ypos", this.value);
        }
        yposValue.oninput = function() {
            yposSlider.value = this.value;
            updateAdjustment("ypos", this.value);
        }
        yposPlus.onclick = function() {
            yposValue.value ++;
            yposSlider.value = yposValue.value;
            updateAdjustment("ypos", yposValue.value);
        }
        yposMinus.onclick = function() {
            yposValue.value --;
            yposSlider.value = yposValue.value;
            updateAdjustment("ypos", yposValue.value);
        }
        yposReset.onclick = function() {
            yposValue.value = yposValue.getAttribute("value");
            yposSlider.value = yposValue.value;
            updateAdjustment("ypos", yposValue.value);
        }
        // Rotation settings
        var rotationSlider = document.getElementById("rotationSlider");
        var rotationValue = document.getElementById("rotationValue");
        var rotationPlus = document.getElementById("rotationPlus");
        var rotationMinus = document.getElementById("rotationMinus");
        var rotationReset = document.getElementById("rotationReset");
        rotationSlider.oninput = function() {
            rotationValue.value = this.value;
            updateAdjustment("rotation", this.value);
        }
        rotationValue.oninput = function() {
            rotationSlider.value = this.value;
            updateAdjustment("rotation", this.value);
        }
        rotationPlus.onclick = function() {
            if(rotationValue.value < 360) {
                rotationValue.value ++;
                rotationSlider.value = rotationValue.value;
                updateAdjustment("rotation", rotationValue.value);
            }
        }
        rotationMinus.onclick = function() {
            if(rotationValue.value > 0) {
                rotationValue.value --;
                rotationSlider.value = rotationValue.value;
                updateAdjustment("rotation", rotationValue.value);
            }
        }
        rotationReset.onclick = function() {
            rotationValue.value = rotationValue.getAttribute("value");
            rotationSlider.value = rotationValue.value;
            updateAdjustment("rotation", rotationValue.value);
        }
    </script>

    <!-- Set phone model in sub-nav -->
    <script src="apple_phones.js"></script> <!-- Apple phones array -->
    <script src="samsung_phones.js"></script> <!-- Samsung phones array -->

    <script>
        const params = new URLSearchParams(window.location.search);
        var modelFound = false;
        var phoneTitle = document.getElementById("selectedPhoneName");
        var phoneMask = document.getElementById("selectedPhoneMask");
        if(params.has("phone")) {
            for(item of apple_phones) {
                if(!modelFound) {
                    if(item.id == params.get("phone")) {
                        phoneTitle.innerHTML = item.name;
                        phoneMask.setAttribute("src", "phone_outlines/ip_temp.png");
                        modelFound = true;
                    }
                } else {
                    break;
                }
            }
            for(item of samsung_phones) {
                if(!modelFound) {
                    if(item.id == params.get("phone")) {
                        phoneTitle.innerHTML = item.name;
                        phoneMask.setAttribute("src", "phone_outlines/s_temp.png");
                        modelFound = true;
                    }
                } else {
                    break;
                }
            }
            if(!modelFound) {
                redirect("phone_selection.html?type=custom");
            }
        } else {
            redirect("phone_selection.html?type=custom");
        }
    </script>


    <!-- Change page brightness -->
    <script>
        var slider = document.getElementById("brightnessSlider");
        var page = document.getElementById("customWrapContainer");
        var mask = document.getElementById("selectedPhoneMask");
        // var root = document.querySelector(":root");
        var correctedValue;
        var shade;

        slider.oninput = function() {
            correctedValue = this.value*10;
            shade = "rgb("+correctedValue+","+correctedValue+","+correctedValue+")";
            page.style.backgroundColor = shade;
            switch(correctedValue) {
                case 0:
                    mask.style.filter = "brightness(0%)";
                    root.style.setProperty("--brightness", "0%");
                    break;
                case 10:
                    mask.style.filter = "brightness(10%)";
                    root.style.setProperty("--brightness", "10%");
                    break;
                case 20:
                    mask.style.filter = "brightness(20%)";
                    root.style.setProperty("--brightness", "20%");
                    break;
                case 30:
                    mask.style.filter = "brightness(56%)";
                    root.style.setProperty("--brightness", "30%");
                    break;
                case 40:
                    mask.style.filter = "brightness(76%)";
                    root.style.setProperty("--brightness", "40%");
                    break;
                case 50:
                    mask.style.filter = "brightness(95%)";
                    root.style.setProperty("--brightness", "50%");
                    break;
                case 60:
                    mask.style.filter = "brightness(112%)";
                    root.style.setProperty("--brightness", "60%");
                    break;
                case 70:
                    mask.style.filter = "brightness(130%)";
                    root.style.setProperty("--brightness", "70%");
                    break;
                case 80:
                    mask.style.filter = "brightness(151%)";
                    root.style.setProperty("--brightness", "80%");
                    break;
                case 90:
                    mask.style.filter = "brightness(170%)";
                    root.style.setProperty("--brightness", "90%");
                    break;
                case 100:
                    mask.style.filter = "brightness(190%)";
                    root.style.setProperty("--brightness", "100%");
                    break;
            }
        }
    </script>
</body>
</html>